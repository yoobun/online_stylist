<!DOCTYPE html>
<html>
    <head>
        <!--Required meta tags-->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- jquery -->
        <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
        
        <title>style finder</title>
    </head>

    <script>
    var style_data = {{ data | tojson }}

    function print_style_data() {
        console.log(JSON.stringify(style_data, null, 3))
    }

    $(function(){
        load_style_data()
    });

    function load_style_data() {
        //loads use case
        use = style_data["use case"]

        likes = style_data["likes"]

        styles = style_data["styles"]

        brands = style_data["brands"]

        suggestions = style_data["suggestions"]
        if(suggestions.length > 0){
            show_suggestions(style_data)
        }

        brands_list = brands_list["brand recs"]
        if(brands_list.length > 0){
            show_brand_list(style_data)
        }

    }

    /*use*/
    $(function() {
        $("#expand_style_btn").click(function(){
            $("#style_likes").show()
            
            let use = $("#expand_style_btn").text()
            submit_use(use)
        })
    });

    function submit_use(use) {
        let data = {"use case":use}
        $.ajax({
            type: "POST",
            url: "/submit_use",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            
            data : JSON.stringify(data),
            success: function (data, text) {
                style_data = data
            }
        });
    }

    /*user info*/
    $(function() {
        $("#submit_likes").click(function(){
            let likes = $("#likes").val()
            let styles = $("#styles").val()
            $.when(submit_user_info(likes, styles)).then(get_suggestions_gpt)
        })
    });

    function submit_user_info(likes, styles) {
        let data = {"likes": likes, "styles": styles}
        $.ajax({
            type: "POST",
            url: "/user_info",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            
            data : JSON.stringify(data),
            success: function (data, text) {
                style_data = data
            }
        });
    }

    /*suggestions*/
    function show_suggestions(data) {
        let suggestions = data["suggestions"]
        $("#generate_sugestions").empty()
        $.each(suggestions, function(i,sug){
            let new_div = $("<div id=sugs>")
            $(new_div).text(sug).click(function(x){
                console.log("sug"+sug)
            })

            $("#generate_sugestions").append(new_div)
        })
    }

    function get_suggestions_gpt() {
        let data = {}
        $.ajax({
            type: "POST",
            url: "/style_suggestions",
            dataType: "json",
            contentType: "applications/json; charset=utf-8",
            data: JSON.stringify(data),

            success: function(data, text){
                console.log("submit_styles response")
                console.log(data)
                style_data = data 
                show_suggestions(style_data)
            },
        }); 
    }

    /*brands list*/
    $(function() {
        $("#submit_brands").click(function(){
            let brands = $("#brands").val()
            $.when(submit_brands(brands)).then(get_brands_gpt)
        })
    });

    function submit_brands(brands) {
        let data = {"brands": brands}
        $.ajax({
            type: "POST",
            url: "/submit_brands",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            
            data : JSON.stringify(data),
            success: function (data, text) {
                style_data = data
            }
        });
    }

    function show_brand_list(data) {
        let brands_list = data["brand recs"]
        $("#generate_brands").empty()
        img_lis = []
        $.each(brands_list, function(i,brand){
            queries = []
            queries.push(brand)
            let new_brand_div = $("<div class='brand_div'>")
            $(new_brand_div).text(brand).click(function(x){
                console.log("brand"+brand)
            })

            $("#generate_brands").append(new_brand_div)
        })
    }

    function get_brands_gpt() {
        let data = {}
        $.ajax({
            type: "POST",
            url: "/brand_suggestions",
            dataType: "json",
            contentType: "applications/json; charset=utf-8",
            data: JSON.stringify(data),

            success: function(data, text){
                console.log("submit_brands response")
                console.log(data)
                style_data = data 
                show_brand_list(style_data)
            },
        }); 
    }

    </script>
    
    <body>
        <h1>let's get to know you!</h1>
        <label>what are you looking for?</label>
        <br>
        <button id="expand_style_btn">expand my style</button><br>
        <div>
            <h1>let's find out what you like</h1>
            <div class="input">
                <label>what do you like to wear? list 3-10 things!</label><br>
                <textarea id="likes" class="txt" rows="1" cols="40"></textarea><br>
            </div>
            <div id="style_likes", class="input">
                <label>what styles do you like to wear? list 3-10</label><br>
                <textarea id = "styles" class="txt" rows="1" cols="40"></textarea><br>
            </div>
            <button id="submit_likes" type="button">submit</button>
            <div id = "generate_sugestions">
    
            </div>
            <h1>what brands do you like?</h1>
            <div class="input">
                <label>list 5-10 brands you like to shop at!</label><br>
                <textarea id = "brands" class="txt" rows="1" cols="40"></textarea><br>
            </div>
            <button id="submit_brands" type="button">submit</button>
            <div id = "generate_brands">
            </div>
        </div>
    </body>
        
</html>


<script async src="https://cse.google.com/cse.js?cx=2618ffd0edf874a79">
</script>
<div class="gcse-search"></div>